<!-- components/modal.html.twig -->
<!-- Modal para asignar/quitar permisos -->
<div class="modal fade" id="permisosModal" tabindex="-1" role="dialog" aria-labelledby="permisosModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="permisosModalLabel">Asignar/Quitar Permisos | {{ usuario.nick }}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
              <label for="selectPermiso">Seleccionar Permiso:</label>
              <select id="selectPermiso" class="form-control">
                {% for role in roles %}
                <option value="{{ role.codrol }}">{{ role.descripcion }}</option>
              {% endfor %}
              </select>
             
            </div>
            
            <!-- Caja de etiquetas de permisos -->
            <div id="permisosBox" class="border p-2 mb-3">
              <!-- Etiquetas de permisos -->
              <span class="badge badge-primary mr-2 mb-2">Permiso 1 <i class="fas fa-times ml-1 eliminar-permiso"></i></span>
              <span class="badge badge-primary mr-2 mb-2">Permiso 2 <i class="fas fa-times ml-1 eliminar-permiso"></i></span>
              <!-- ... (más etiquetas de permisos) ... -->
            </div>
          </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary">Guardar cambios</button>
          <!-- Botones u opciones para realizar acciones en el modal -->
        </div>
      </div>
    </div>
  </div>
  <!-- Agrega el script al final de tu archivo para manejar el evento de eliminación -->
<!-- Agrega el script al final de tu archivo para manejar el evento del select -->
<script>
  $(document).ready(function() {
    // Manejar el evento de cambio en el select para añadir permisos
    $('#selectPermiso').change(function() {
      var permisoSeleccionado = $(this).val(); // Obtener el permiso seleccionado

      // Agregar una nueva etiqueta de permiso al permisosBox
      $('#permisosBox').append('<span class="badge badge-primary mr-2 mb-2">' + permisoSeleccionado + ' <i class="fas fa-times ml-1 eliminar-permiso"></i></span>');
    });

    // Manejar el evento de clic en la "tachita" para eliminar el permiso
    $('#permisosBox').on('click', '.eliminar-permiso', function() {
      $(this).parent().remove(); // Elimina la etiqueta del permiso al hacer clic en el ícono
    });
  });

  // Manejar el evento de abrir el modal.
$('#permisosModal').on('shown.bs.modal', function (event) {
    // Obtenemos el botón que disparó el modal
    var button = $(event.relatedTarget);

    // Obtenemos el nick del usuario a través del atributo data-nick
    var nick = button.data('nick');
    var baseUrl = window.location.origin;
    // Llamar a la función AJAX que devuelve los roles de usuario
    $.ajax({
        url: baseUrl + "/sistema2/RolesUsuarios",
        method: 'GET',
        headers: {
            'Token': 'API_TOKEN'
        },
        data: {
            nick: nick
        },
        success: function(data) {
            // Limpiar el permisosBox
            $('#permisosBox').empty();
            var dataArray = JSON.parse(data); // Convertir la cadena de texto a un array

            // Agregar cada rol del usuario al permisosBox
            dataArray.forEach(function (role) {
                $('#permisosBox').append('<span class="badge badge-primary mr-2 mb-2">' + role.codrole + ' <i class="fas fa-times ml-1 eliminar-permiso"></i></span>');
            });
        },
        error: function(error){
            console.log('Hubo un error al obtener los roles: ', error);
        },
    });
});
</script>