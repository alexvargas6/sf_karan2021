<!-- components/modal.html.twig -->
<!-- Modal para asignar/quitar permisos -->
<div
  class="modal fade"
  id="permisosModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="permisosModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="permisosModalLabel">
          Asignar/Quitar Permisos | {{ usuario.nick }}
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="selectPermiso">Seleccionar Permiso:</label>
          <select id="selectPermiso" class="form-control">
            <option value="0">Seleccione el rol para asignar</option>
            {% for role in roles %}
            <option value="{{ role.codrole }}">{{ role.descripcion }}</option>
            {% endfor %}
          </select>
          <input type="hidden" id="nick" />
          <input type="hidden" id="rolesActuales" />
        </div>

        <!-- Caja de etiquetas de permisos -->
        <div id="permisosBox" class="border p-2 mb-3">
          <!-- Etiquetas de permisos -->

          <!-- ... (más etiquetas de permisos) ... -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Cerrar
        </button>
        <button type="button" id="btn-guardar" class="btn btn-primary">
          Guardar cambios
        </button>
        <!-- Botones u opciones para realizar acciones en el modal -->
      </div>
    </div>
  </div>
</div>
<!-- Agrega el script al final de tu archivo para manejar el evento de eliminación -->
<!-- Agrega el script al final de tu archivo para manejar el evento del select -->
<script>
  $(document).ready(function () {
    // Manejar el evento de cambio en el select para añadir permisos
    $("#selectPermiso").change(function () {
      var permisoSeleccionado = $(this).val(); // Obtener el permiso seleccionado
      var permisoDescripcion = $("#selectPermiso option:selected").text(); // Obtener la descripción seleccionada
      if (permisoSeleccionado == 0) {
        return false;
      }
      // Agregar una nueva etiqueta de permiso al permisosBox
      $("#permisosBox").append(
        '<span class="badge badge-success mr-2 mb-2" data-value="' +
          permisoSeleccionado +
          '">' +
          permisoDescripcion +
          ' <i class="fas fa-times ml-1 eliminar-permiso"></i></span>'
      );
      // Deshabilitar la opción correspondiente en el select
      $("#selectPermiso option:selected").prop("disabled", true);
    });

    // Manejar el evento de clic en la "tachita" para eliminar el permiso
    $("#permisosBox").on("click", ".eliminar-permiso", function () {
      var permisoEliminado = $(this).parent().data("value"); // Obtener el permiso eliminado

      // Habilitar la opción correspondiente en el select
      $("#selectPermiso option[value='" + permisoEliminado + "']").prop(
        "disabled",
        false
      );

      $(this).parent().remove(); // Elimina la etiqueta del permiso al hacer clic en el ícono
    });
  });

  function guardarRolesUs() {}
</script>
<script src="/sistema2/Plugins/asignacion_usuarios/Assets/JS/getRoles.js"></script>
<script src="/sistema2/Plugins/asignacion_usuarios/Assets/JS/insertUs.js"></script>
